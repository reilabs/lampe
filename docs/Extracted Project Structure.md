# Extracted Project Structure

Lampe and the `lampe` CLI tool are quite opinionated when it comes to the structure of the project
containing the definitions extracted from the Noir crate in question. An extracted project has a
tree structure similar to the following, for a project with name `LibName` and version string
`Version`:

```
<extraction_target>/
├─ LibName-Version/
│  ├─ Extracted/
│  │  ├─ <lib_files_as_lean_files...>
│  │  ├─ GeneratedTypes.lean
│  │  └─ LibName-Version.lean
│  └─ Extracted.lean
├─ lake-manifest.json
├─ lakefile.toml
├─ lean-toolchain
└─ LibName-Version.lean
```

Everything under the `Extracted` directory is generally intended to be solely files generated by the
`lampe` CLI tool's extraction process. All definitions there are generated into the namespace
`LibName-Version.Extracted`, which can be opened to access the definitions.

## Code Structure

Within the `Extracted` directory, the extractor tool aims to replicate the structure of the original
library as much as possible. This means that there will be one `foo.lean` file that corresponds to
each `foo.nr` file, and the folder structure will be replicated wherever possible.

You will note that the import paths do not change the namespacing of the generated definitions. All
generated definitions are available when you `open LibName-Version.Extracted`, and are _named_ with
their full path in the source crate. That said, importing the correct file is required to make the
definitions in those files _visible_ in that namespace.

In addition, there are two special files that can be found under the `Extracted` directory:

- `GeneratedTypes.lean` contains all of the type, trait, and type alias definitions from the source
  crate. The definitions are extracted in dependency order in order to be made available in all
  other extracted files, as Lean does not support circular imports between files.
- `LibName-Version.lean` This file imports all of the generated files in order to ensure that they
  get built, but more importantly it defines the _[environment](#environment)_ for the entire
  library.

## Environment

The environment is a construct that describes what functions and trait implementations are available
to the bodies of all the extracted constructs. It can be thought of as a representation of what was
accessible at the definition scope of the entire library.

Each of the `Foo.lean` files that corresponds to a file in the library will have its own environment
construction at the bottom, containing all of the things that file defined. What the
`LibName-Version.lean` file does, however, is put all of those together to provide an environment
for the _entire library_.

## Proving Properties of Code

Theorems can be stated about the extracted definition in _any Lean file_. However, we advise against
putting theorem statements in any file that has the header saying that it was generated by Lampe as
these files will be overwritten whenever you extract your library. 

For smaller sets of theorems, we recommend creating a `Spec.lean` file in the `LibName-Version`
directory described above. However, when working to verify an entire library, our advice is to
create a separate tree directly under the `<extraction_target>` directory that contains all of the
various files needed to state and prove your theorems. This directory structure can mirror the one
in the `Extracted` directory, or can be entirely its own thing. 

Regardless, we recommend putting proofs to do with a given type in a namespace named like the type.
For example, `unwrap_spec` for `Option` is in the `Option` namespace, making it clear which proof
is being referred to from another proof; it will be `Option.unwrap_spec` instead of a bare (and
potentially ambiguous) `unwrap_spec`.

